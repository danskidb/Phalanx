#include "DisplayBase.h"

union iv4Data { uint32_t int32; uint8_t int8[4]; };

/*
    DisplayIV4 - Ameise
    - IV-12 is a 18-segment display (including dots), including 2 dead pins on the HV5182, we need 20 bits per tube.
    - 8 tubes.

    - -     0   LDP         10  B
   |\|/|    1   G           11  O
    - -     2   F           12  M
   |/|\|    3   P           13  L
   .- -.    4   R           14  K
            5   S           15  N
            6   E           16  A
            7   D           17  H  
            8   RDP         18  Not Connected
            9   C           19  Not Connected
*/
class DisplayIV4 : public DisplayBase
{
protected:
    const int Digits = 8;
    const int DisplayBytes = 20; // 20 bits * 8 tubes = 160 bits = 20 bytes.

    volatile byte displayData[20];

public:
    bool Initialize();
    void IRAM_ATTR OnTick();
    void ShiftCurrentTimeFull(int hour, int minute, int second, bool displayZeroFirstDigit);
    void ShiftCurrentTime(int hour, int minute, int second, bool displayZeroFirstDigit);
    void ShiftRaw(byte data[]);
    void ShiftText(String text);
    void ShiftBlank();

private:
    void InternalShiftDigit(iv4Data tubeDigit);
};

const iv4Data TubeDigit[10] = {
    // NOTE: uint32_t is 32bits, and our shift register is 20bits. 12 bits get added to the front!
    //.GFPRSED.CBOMLKNAH--
    0b01100011011000001100, // 0
    0b00000001010000000000, // 1
    0b01100010011100011000, // 2
    0b00100011011100011000, // 3
    0b00000001010100010100, // 4
    0b00100011001100011100, // 5
    0b01100011001100011100, // 6
    0b00000001011000001000, // 7
    0b01100011011100011100, // 8
    0b00100011011100011100, // 9
};

const iv4Data CharMap[128] = {
    // NOTE: uint32_t is 32bits, and our shift register is 20bits. 12 bits get added to the front!
    //.GFPRSED.CBOMLKNAH--
    0b00000000000000000000, //	0	NUL
    0b00000000000000000000, //	1	SOH
    0b00000000000000000000, //	2	STX
    0b00000000000000000000, //	3	ETX
    0b00000000000000000000, //	4	EOT
    0b00000000000000000000, //	5	ENQ
    0b00000000000000000000, //	6	ACK
    0b00000000000000000000, //	7	BEL
    0b00000000000000000000, //	8	BS
    0b00000000000000000000, //	9	HT
    0b00000000000000000000, //	10	LF
    0b00000000000000000000, //	11	VT
    0b00000000000000000000, //	12	FF
    0b00000000000000000000, //	13	CR
    0b00000000000000000000, //	14	SO
    0b00000000000000000000, //	15	SI
    0b00000000000000000000, //	16	DLE
    0b00000000000000000000, //	17	DC1
    0b00000000000000000000, //	18	DC2
    0b00000000000000000000, //	19	DC3
    0b00000000000000000000, //	20	DC4
    0b00000000000000000000, //	21	NAK
    0b00000000000000000000, //	22	SYN
    0b00000000000000000000, //	23	ETB
    0b00000000000000000000, //	24	CAN
    0b00000000000000000000, //	25	EM
    0b00000000000000000000, //	26	SUB
    0b00000000000000000000, //	27	ESC
    0b00000000000000000000, //	28	FS
    0b00000000000000000000, //	29	GS
    0b00000000000000000000, //	30	RS
    0b00000000000000000000, //	31	US
    0b00000000000000000000, //	32	
    0b00000001110000000000, //	33	!
    0b00000000000001000100, //	34	"
    0b00000000000000000000, //	35	#
    0b00101011001101011100, //	36	$
    0b00011001000111011100, //	37	%
    0b00111100000001011100, //	38	&
    0b00000000000000000100, //	39	'
    0b00001010001001000000, //	40	(
    0b00101000000001001000, //	41	)
    0b00000000000000000000, //	42	*
    0b00001000000101010000, //	43	+
    0b10000000000000000000, //	44	,
    0b00000000000100010000, //	45	-
    0b10000000000000000000, //	46	.
    0b00010000000010000000, //	47	/
    0b01100011011000001100, //	48	0
    0b00000001010000000000, //	49	1
    0b01100010011100011000, //	50	2
    0b00100011011100011000, //	51	3
    0b00000001010100010100, //	52	4
    0b00100011001100011100, //	53	5
    0b01100011001100011100, //	54	6
    0b00000001011000001000, //	55	7
    0b01100011011100011100, //	56	8
    0b00100011011100011100, //	57	9
    0b00000000000000000000, //	58	:
    0b00000000000000000000, //	59	;
    0b00000100000010000000, //	60	<
    0b00100010000100010000, //	61	=
    0b00010000000000100000, //	62	>
    0b00000001111001000000, //	63	?
    0b00000000000000000000, //	64	@
    0b01000001011100011100, //	65	A
    0b01100110001010011100, //	66	B
    0b01100010001000001100, //	67	C
    0b01100011011000001100, //	68	D
    0b01100010001100011100, //	69	E
    0b01000000001100011100, //	70	F
    0b01100011001100001100, //	71	G
    0b01000001010100010100, //	72	H
    0b00101010001001001000, //	73	I
    0b00100011010000000000, //	74	J
    0b01000100000010010100, //	75	K
    0b01100010000000000100, //	76	L
    0b01000001010010100100, //	77	M
    0b01000101010000100100, //	78	N
    0b01100011011000001100, //	79	O
    0b01000000011100011100, //	80	P
    0b01100111011000001100, //	81	Q
    0b01000100011100011100, //	82	R
    0b00100011001100011100, //	83	S
    0b00001000001001001000, //	84	T
    0b01100011010000000100, //	85	U
    0b00000101010000100000, //	86	V
    0b01010101010000000100, //	87	W
    0b00010100000010100000, //	88	X
    0b00001000000010100000, //	89	Y
    0b00110010001010001000, //	90	Z
    0b00001010001001000000, //	91	[
    0b00000100000000100000, //	92	backslash
    0b00101000000001001000, //	93	]
    0b00000000000000000000, //	94	^
    0b00100010000000000000, //	95	_
    0b00000000000000100000, //	96	`
    0b01000001011100011100, //	97	a
    0b01100110001010011100, //	98	b
    0b01100010001000001100, //	99	c
    0b01100011011000001100, //	100	d
    0b01100010001100011100, //	101	e
    0b01000000001100011100, //	102	f
    0b01100011001100001100, //	103	g
    0b01000001010100010100, //	104	h
    0b00101010001001001000, //	105	i
    0b00100011010000000000, //	106	j
    0b01000100000010010100, //	107	k
    0b01100010000000000100, //	108	l
    0b01000001010010100100, //	109	m
    0b01000101010000100100, //	110	n
    0b01100011011000001100, //	111	o
    0b01000000011100011100, //	112	p
    0b01100111011000001100, //	113	q
    0b01000100011100011100, //	114	r
    0b00100011001100011100, //	115	s
    0b00001000001001001000, //	116	t
    0b01100011010000000100, //	117	u
    0b00000101010000100000, //	118	v
    0b01010101010000000100, //	119	w
    0b00010100000010100000, //	120	x
    0b00001000000010100000, //	121	y
    0b00110010001010001000, //	122	z
    0b00001010001001000000, //	123	{
    0b00001000000001000000, //	124	|
    0b00101000000001001000, //	125	}
    0b00000000000000000000, //	126	~
    0b00000000000000000000, //	127	DEL
};